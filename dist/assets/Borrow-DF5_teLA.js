import{_ as Q,i as W,c as B,b as n,w as o,r as s,d as r,e as X,o as l,l as i,n as y,F,k as j,a as h,t as x,f as b}from"./index-BC7CpVgk.js";import{g as A,r as Z}from"./borrow-Bb7Fnbv5.js";import{d as L}from"./dayjs.min-CxMP4GVf.js";import{s as ee}from"./function-call-CK6byjUD.js";import{s as te}from"./request-BWFo0bpa.js";const ae={class:"borrow-page"},oe={class:"due-date"},se={class:"return-date"},ne={__name:"Borrow",setup(le){const D=s("borrowing"),E=X(),u=s([]),c=s(!1),v=s(!1),f=s(!1),w=s(1),H=s(10),d=s([]),p=s(!1),_=s(!1),m=s(!1),k=s(1),g=t=>t?L(t).format("YYYY-MM-DD"):"-",I=t=>L().isAfter(L(t)),O=t=>({borrowed:"primary",overdue:"danger",returned:"success"})[t]||"default",q=t=>({borrowed:"借阅中",overdue:"已逾期",returned:"已归还"})[t]||"未知",V=async()=>{f.value&&(u.value=[],w.value=1,f.value=!1);try{const t=await A({page:w.value,pageSize:H.value,status:"borrowed"});u.value=[...u.value,...t.data.list||[]],c.value=!1,u.value.length>=t.data.total?v.value=!0:w.value++}catch{c.value=!1,v.value=!0}},R=()=>{v.value=!1,c.value=!0,V()},S=async()=>{m.value&&(d.value=[],k.value=1,m.value=!1);try{const t=await A({page:k.value,pageSize:H.value,status:"returned"});d.value=[...d.value,...t.data.list||[]],p.value=!1,d.value.length>=t.data.total?_.value=!0:k.value++}catch{p.value=!1,_.value=!0}},G=()=>{_.value=!1,p.value=!0,S()},J=async t=>{try{await ee({title:"确认续借",message:"确定要续借这本书吗？"}),await Z(t),te({type:"success",message:"续借成功"}),R()}catch(a){a!=="cancel"&&console.error("续借失败:",a)}},T=t=>{E.push(`/borrow/detail/${t}`)};return W(()=>{V()}),(t,a)=>{const $=r("van-empty"),C=r("van-tag"),K=r("van-button"),z=r("van-card"),N=r("van-list"),Y=r("van-pull-refresh"),M=r("van-tab"),P=r("van-tabs");return l(),B("div",ae,[n(P,{modelValue:D.value,"onUpdate:modelValue":a[2]||(a[2]=e=>D.value=e),sticky:""},{default:o(()=>[n(M,{title:"当前借阅",name:"borrowing"},{default:o(()=>[n(Y,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),onRefresh:R},{default:o(()=>[n(N,{loading:c.value,finished:v.value,"finished-text":"没有更多了",onLoad:V},{default:o(()=>[u.value.length===0?(l(),i($,{key:0,description:"暂无借阅记录"})):y("",!0),(l(!0),B(F,null,j(u.value,e=>(l(),i(z,{key:e.id,title:e.book_title,desc:`借阅时间: ${g(e.borrow_date)}`,thumb:e.book_cover||"https://picsum.photos/100",onClick:U=>T(e.id)},{tags:o(()=>[n(C,{type:O(e.status)},{default:o(()=>[b(x(q(e.status)),1)]),_:2},1032,["type"])]),footer:o(()=>[h("div",oe,[h("span",null,"应还日期: "+x(g(e.due_date)),1),I(e.due_date)?(l(),i(C,{key:0,type:"danger",size:"small"},{default:o(()=>[...a[3]||(a[3]=[b("已逾期",-1)])]),_:1})):y("",!0)]),e.status==="borrowed"?(l(),i(K,{key:0,size:"mini",type:"primary",onClick:U=>J(e.id)},{default:o(()=>[...a[4]||(a[4]=[b(" 续借 ",-1)])]),_:1},8,["onClick"])):y("",!0)]),_:2},1032,["title","desc","thumb","onClick"]))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])]),_:1}),n(M,{title:"历史借阅",name:"history"},{default:o(()=>[n(Y,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e),onRefresh:G},{default:o(()=>[n(N,{loading:p.value,finished:_.value,"finished-text":"没有更多了",onLoad:S},{default:o(()=>[d.value.length===0?(l(),i($,{key:0,description:"暂无历史记录"})):y("",!0),(l(!0),B(F,null,j(d.value,e=>(l(),i(z,{key:e.id,title:e.book_title,desc:`借阅时间: ${g(e.borrow_date)}`,thumb:e.book_cover||"https://picsum.photos/100",onClick:U=>T(e.id)},{tags:o(()=>[n(C,{type:"success"},{default:o(()=>[...a[5]||(a[5]=[b("已归还",-1)])]),_:1})]),footer:o(()=>[h("div",se,[h("span",null,"归还时间: "+x(g(e.return_date)),1)])]),_:2},1032,["title","desc","thumb","onClick"]))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])])}}},ve=Q(ne,[["__scopeId","data-v-f1a2030c"]]);export{ve as default};
