import{_ as D,i as N,c as u,b as a,w as o,a as c,n as $,r as m,d as s,h as V,e as R,o as i,f as r,t as v}from"./index-BC7CpVgk.js";import{a as z,r as I}from"./books-BDs5bHVb.js";import{b as L}from"./borrow-Bb7Fnbv5.js";import{s as _}from"./request-BWFo0bpa.js";import{s as S}from"./function-call-CK6byjUD.js";const T={class:"book-detail-page"},E={key:0,class:"loading-container"},M={key:1,class:"detail-content"},j={class:"book-cover"},q={class:"description"},A={class:"action-buttons"},F={__name:"BookDetail",setup(G){const f=R(),b=V(),e=m(null),n=m(!0),h=()=>{f.back()},g=async()=>{n.value=!0;try{const l=await z(b.params.id);e.value=l.data}catch(l){console.error("获取图书详情失败:",l),_("获取图书详情失败")}finally{n.value=!1}},k=async()=>{try{await S({title:e.value.status===1?"确认借阅":"确认预约",message:`确定要${e.value.status===1?"借阅":"预约"}《${e.value.title}》吗？`}),e.value.status===1?(await L({book_id:e.value.id}),_({type:"success",message:"借阅成功"})):(await I({book_id:e.value.id}),_({type:"success",message:"预约成功"}))}catch(l){l!=="cancel"&&console.error("操作失败:",l)}};return N(()=>{g()}),(l,d)=>{const y=s("van-nav-bar"),w=s("van-loading"),B=s("van-image"),t=s("van-cell"),C=s("van-tag"),p=s("van-cell-group"),x=s("van-button");return i(),u("div",T,[a(y,{title:"图书详情","left-arrow":"",onClickLeft:h}),n.value?(i(),u("div",E,[a(w,{size:"24px",vertical:""},{default:o(()=>[...d[0]||(d[0]=[r("加载中...",-1)])]),_:1})])):e.value?(i(),u("div",M,[c("div",j,[a(B,{width:"150",height:"200",fit:"cover",src:e.value.cover?`http://localhost:3000${e.value.cover}`:"https://picsum.photos/150/200"},null,8,["src"])]),a(p,{inset:"",title:"基本信息"},{default:o(()=>[a(t,{title:"书名",value:e.value.title},null,8,["value"]),a(t,{title:"作者",value:e.value.author},null,8,["value"]),a(t,{title:"ISBN",value:e.value.isbn},null,8,["value"]),a(t,{title:"出版社",value:e.value.publisher},null,8,["value"]),a(t,{title:"出版日期",value:e.value.publish_date},null,8,["value"]),a(t,{title:"分类",value:e.value.category_name},null,8,["value"]),a(t,{title:"价格",value:`¥${e.value.price}`},null,8,["value"]),a(t,{title:"馆藏位置",value:e.value.location},null,8,["value"]),a(t,{title:"库存状态"},{value:o(()=>[a(C,{type:e.value.available_count>0?"success":"warning"},{default:o(()=>[r(v(e.value.available_count>0?`可借 ${e.value.available_count}本`:"已借完"),1)]),_:1},8,["type"])]),_:1})]),_:1}),a(p,{inset:"",title:"图书描述"},{default:o(()=>[a(t,null,{title:o(()=>[c("div",q,v(e.value.description||"暂无描述"),1)]),_:1})]),_:1}),c("div",A,[a(x,{round:"",block:"",type:"primary",size:"large",disabled:e.value.status!==1&&e.value.available_count<=0,onClick:k},{default:o(()=>[r(v(e.value.status===1?"立即借阅":"立即预约"),1)]),_:1},8,["disabled"])])])):$("",!0)])}}},Q=D(F,[["__scopeId","data-v-7cc34031"]]);export{Q as default};
