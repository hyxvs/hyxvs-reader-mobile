import{_ as F,i as T,c as w,b as o,w as s,r as l,d as n,e as I,o as _,a as M,F as O,k as E,l as j,m as q,f,t as h}from"./index-BC7CpVgk.js";import{g as A,r as G}from"./books-BDs5bHVb.js";import{s as H}from"./function-call-CK6byjUD.js";import{s as J}from"./request-BWFo0bpa.js";const K={class:"books-page"},P={__name:"Books",setup(Q){const V=I(),u=l({keyword:"",category_id:"",status:""}),x=l([{text:"全部分类",value:""},{text:"文学",value:1},{text:"科技",value:2},{text:"历史",value:3}]),B=l([{text:"全部状态",value:""},{text:"可借",value:"available"},{text:"已借完",value:"empty"}]),r=l([]),c=l(!1),i=l(!1),d=l(!1),v=l(1),C=l(10),p=async()=>{d.value&&(r.value=[],v.value=1,d.value=!1);try{const t=await A({page:v.value,pageSize:C.value,...u.value});r.value=[...r.value,...t.data.list||[]],c.value=!1,r.value.length>=t.data.total?i.value=!0:v.value++}catch{c.value=!1,i.value=!0}},k=()=>{i.value=!1,c.value=!0,p()},m=()=>{r.value=[],v.value=1,i.value=!1,p()},S=t=>{V.push(`/books/${t}`)},z=async t=>{try{await H({title:"确认预约",message:`确定要预约《${t.title}》吗？`}),await G({book_id:t.id}),J({type:"success",message:"预约成功"})}catch(a){a!=="cancel"&&console.error("预约失败:",a)}};return T(()=>{p()}),(t,a)=>{const $=n("van-search"),g=n("van-dropdown-item"),L=n("van-dropdown-menu"),y=n("van-tag"),N=n("van-button"),R=n("van-card"),U=n("van-list"),b=n("van-pull-refresh");return _(),w("div",K,[o($,{modelValue:u.value.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value.keyword=e),placeholder:"搜索书名、作者、ISBN","show-action":"",shape:"round",onSearch:m},{action:s(()=>[M("div",{onClick:m},"搜索")]),_:1},8,["modelValue"]),o(L,null,{default:s(()=>[o(g,{modelValue:u.value.category_id,"onUpdate:modelValue":a[1]||(a[1]=e=>u.value.category_id=e),options:x.value,onChange:m},null,8,["modelValue","options"]),o(g,{modelValue:u.value.status,"onUpdate:modelValue":a[2]||(a[2]=e=>u.value.status=e),options:B.value,onChange:m},null,8,["modelValue","options"])]),_:1}),o(b,{modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=e=>d.value=e),onRefresh:k},{default:s(()=>[o(U,{loading:c.value,finished:i.value,"finished-text":"没有更多了",onLoad:p},{default:s(()=>[(_(!0),w(O,null,E(r.value,e=>(_(),j(R,{key:e.id,title:e.title,desc:e.author,thumb:e.cover?`http://localhost:3000${e.cover}`:"https://picsum.photos/100",onClick:D=>S(e.id)},{tags:s(()=>[o(y,{type:"primary",size:"small"},{default:s(()=>[f(h(e.category_name),1)]),_:2},1024),o(y,{type:e.available_count>0?"success":"warning",size:"small"},{default:s(()=>[f(h(e.available_count>0?"可借":"已借完"),1)]),_:2},1032,["type"])]),footer:s(()=>[o(N,{size:"mini",type:"primary",onClick:q(D=>z(e),["stop"]),disabled:e.available_count<=0},{default:s(()=>[f(h(e.available_count>0?"预约":"已借完"),1)]),_:2},1032,["onClick","disabled"])]),_:2},1032,["title","desc","thumb","onClick"]))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])])}}},ee=F(P,[["__scopeId","data-v-d90a7f9a"]]);export{ee as default};
