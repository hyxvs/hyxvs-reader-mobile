import{_ as K,i as O,c as C,b as s,w as a,r as l,d as n,e as P,o as u,l as g,n as Y,F as z,k as M,a as h,t as U,f as V}from"./index-BC7CpVgk.js";import{g as F,c as Q}from"./reservation-WAyaT4Qw.js";import{d as W}from"./dayjs.min-CxMP4GVf.js";import{s as X}from"./function-call-CK6byjUD.js";import{s as Z}from"./request-BWFo0bpa.js";const ee={class:"reservation-page"},ae={class:"expire-date"},te={class:"complete-date"},oe={__name:"Reservation",setup(le){const H=P(),w=l("pending"),r=l([]),v=l(!1),p=l(!1),d=l(!1),y=l(1),x=l(10),i=l([]),f=l(!1),_=l(!1),c=l(!1),k=l(1),m=t=>t?W(t).format("YYYY-MM-DD HH:mm"):"-",b=async()=>{d.value&&(r.value=[],y.value=1,d.value=!1);try{const t=await F({page:y.value,pageSize:x.value,status:"pending"});r.value=[...r.value,...t.data.list||[]],v.value=!1,d.value=!1,r.value.length>=t.data.total?p.value=!0:y.value++}catch{v.value=!1,p.value=!0,d.value=!1}},R=()=>{p.value=!1,v.value=!0,b()},L=async()=>{c.value&&(i.value=[],k.value=1,c.value=!1);try{const t=await F({page:k.value,pageSize:x.value,status:"completed"});i.value=[...i.value,...t.data.list||[]],f.value=!1,c.value=!1,i.value.length>=t.data.total?_.value=!0:k.value++}catch{f.value=!1,_.value=!0,c.value=!1}},j=()=>{_.value=!1,f.value=!0,L()},q=t=>{H.push(`/books/${t}`)},E=async t=>{try{await X({title:"确认取消",message:"确定要取消这个预约吗？"}),await Q(t),Z({type:"success",message:"取消成功"}),R()}catch(o){o!=="cancel"&&console.error("取消失败:",o)}};return O(()=>{b()}),(t,o)=>{const D=n("van-empty"),B=n("van-tag"),$=n("van-card"),I=n("van-button"),A=n("van-swipe-cell"),N=n("van-list"),S=n("van-pull-refresh"),T=n("van-tab"),G=n("van-tabs");return u(),C("div",ee,[s(G,{modelValue:w.value,"onUpdate:modelValue":o[2]||(o[2]=e=>w.value=e),sticky:""},{default:a(()=>[s(T,{title:"待处理",name:"pending"},{default:a(()=>[s(S,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=e=>d.value=e),onRefresh:R},{default:a(()=>[s(N,{loading:v.value,finished:p.value,"finished-text":"没有更多了",onLoad:b},{default:a(()=>[r.value.length===0?(u(),g(D,{key:0,description:"暂无预约记录"})):Y("",!0),(u(!0),C(z,null,M(r.value,e=>(u(),g(A,{key:e.id},{right:a(()=>[s(I,{square:"",text:"",type:"danger",style:{height:"100%"},onClick:J=>E(e.id)},{default:a(()=>[...o[4]||(o[4]=[V(" 取消 ",-1)])]),_:1},8,["onClick"])]),default:a(()=>[s($,{title:e.book_title,desc:`预约时间: ${m(e.appointment_date)}`,thumb:e.book_cover||"https://picsum.photos/100",onClick:J=>q(e.book_id)},{tags:a(()=>[s(B,{type:"primary"},{default:a(()=>[...o[3]||(o[3]=[V("待处理",-1)])]),_:1})]),footer:a(()=>[h("div",ae,[h("span",null,"过期时间: "+U(m(e.expire_date)),1)])]),_:2},1032,["title","desc","thumb","onClick"])]),_:2},1024))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])]),_:1}),s(T,{title:"已完成",name:"completed"},{default:a(()=>[s(S,{modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=e=>c.value=e),onRefresh:j},{default:a(()=>[s(N,{loading:f.value,finished:_.value,"finished-text":"没有更多了",onLoad:L},{default:a(()=>[i.value.length===0?(u(),g(D,{key:0,description:"暂无已完成记录"})):Y("",!0),(u(!0),C(z,null,M(i.value,e=>(u(),g($,{key:e.id,title:e.book_title,desc:`预约时间: ${m(e.appointment_date)}`,thumb:e.book_cover||"https://via.placeholder.com/100"},{tags:a(()=>[s(B,{type:"success"},{default:a(()=>[...o[5]||(o[5]=[V("已完成",-1)])]),_:1})]),footer:a(()=>[h("div",te,[h("span",null,"完成时间: "+U(m(e.updated_at)),1)])]),_:2},1032,["title","desc","thumb"]))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])])}}},ie=K(oe,[["__scopeId","data-v-203d0983"]]);export{ie as default};
