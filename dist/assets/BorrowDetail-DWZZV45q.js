import{_ as z,i as I,c as u,b as a,w as n,n as d,r as y,d as r,h as M,e as R,o as s,f as i,t as w,a as H,l as g}from"./index-BC7CpVgk.js";import{a as L,r as j}from"./borrow-Bb7Fnbv5.js";import{d as _}from"./dayjs.min-CxMP4GVf.js";import{s as b}from"./request-BWFo0bpa.js";import{s as A}from"./function-call-CK6byjUD.js";const E={class:"borrow-detail-page"},O={key:0,class:"loading-container"},q={key:1,class:"detail-content"},F={key:0,class:"action-buttons"},G={key:2,class:"empty-container"},J={__name:"BorrowDetail",setup(K){const k=R(),h=M(),e=y(null),c=y(!0),B=()=>{k.back()},v=t=>t?_(t).format("YYYY-MM-DD HH:mm:ss"):"-",D=t=>_().isAfter(_(t)),x=t=>({borrowed:"primary",overdue:"danger",returned:"success"})[t]||"default",C=t=>({borrowed:"借阅中",overdue:"已逾期",returned:"已归还"})[t]||"未知",p=async()=>{c.value=!0;try{const t=await L(h.params.id);e.value=t.data}catch(t){console.error("获取借阅详情失败:",t),b("获取借阅详情失败")}finally{c.value=!1}},N=async()=>{try{await A({title:"确认续借",message:"确定要续借这本书吗？"}),await j(e.value.id),b({type:"success",message:"续借成功"}),p()}catch(t){t!=="cancel"&&console.error("续借失败:",t)}};return I(()=>{p()}),(t,l)=>{const S=r("van-nav-bar"),T=r("van-loading"),o=r("van-cell"),m=r("van-cell-group"),f=r("van-tag"),V=r("van-button"),Y=r("van-empty");return s(),u("div",E,[a(S,{title:"借阅详情","left-arrow":"",onClickLeft:B}),c.value?(s(),u("div",O,[a(T,{size:"24px",vertical:""},{default:n(()=>[...l[0]||(l[0]=[i("加载中...",-1)])]),_:1})])):e.value?(s(),u("div",q,[a(m,{inset:"",title:"图书信息"},{default:n(()=>[a(o,{title:"书名",value:e.value.title||"-"},null,8,["value"]),a(o,{title:"ISBN",value:e.value.isbn||"-"},null,8,["value"]),a(o,{title:"作者",value:e.value.author||"-"},null,8,["value"]),a(o,{title:"出版社",value:e.value.publisher||"-"},null,8,["value"])]),_:1}),a(m,{inset:"",title:"借阅信息"},{default:n(()=>[a(o,{title:"借阅状态"},{value:n(()=>[a(f,{type:x(e.value.status)},{default:n(()=>[i(w(C(e.value.status)),1)]),_:1},8,["type"])]),_:1}),a(o,{title:"借阅时间",value:v(e.value.borrow_date)},null,8,["value"]),a(o,{title:"应还时间"},{value:n(()=>[H("div",null,[i(w(v(e.value.due_date))+" ",1),D(e.value.due_date)?(s(),g(f,{key:0,type:"danger",size:"small"},{default:n(()=>[...l[1]||(l[1]=[i("已逾期",-1)])]),_:1})):d("",!0)])]),_:1}),e.value.return_date?(s(),g(o,{key:0,title:"实际归还时间",value:v(e.value.return_date)},null,8,["value"])):d("",!0),a(o,{title:"借阅编号",value:e.value.id||"-"},null,8,["value"]),a(o,{title:"读者编号",value:e.value.reader_id||"-"},null,8,["value"])]),_:1}),e.value.status==="borrowed"?(s(),u("div",F,[a(V,{round:"",block:"",type:"primary",size:"large",onClick:N},{default:n(()=>[...l[2]||(l[2]=[i(" 续借 ",-1)])]),_:1})])):d("",!0)])):(s(),u("div",G,[a(Y,{description:"借阅记录不存在"})]))])}}},Z=z(J,[["__scopeId","data-v-1692dbde"]]);export{Z as default};
